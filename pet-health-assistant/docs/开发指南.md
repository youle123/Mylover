# AI宠物健康管理助手 - 开发指南

## 1. 开发环境搭建

### 1.1 必需工具
- **微信开发者工具**: 最新稳定版
- **Node.js**: v14.0.0 或以上版本
- **Git**: 版本控制工具

### 1.2 环境配置
1. 下载并安装微信开发者工具
2. 注册微信小程序账号，获取AppID
3. 开通微信云开发服务
4. 配置云开发环境

### 1.3 项目初始化
```bash
# 克隆项目
git clone <repository-url>
cd pet-health-assistant

# 使用微信开发者工具打开项目
# 配置AppID和云开发环境ID
```

## 2. 项目结构说明

```
pet-health-assistant/
├── miniprogram/                 # 小程序前端代码
│   ├── pages/                  # 页面文件
│   │   ├── index/              # 首页
│   │   ├── pets/               # 宠物列表
│   │   ├── health/             # 健康管理
│   │   └── ...                 # 其他页面
│   ├── components/             # 自定义组件
│   │   ├── pet-card/           # 宠物卡片组件
│   │   ├── health-chart/       # 健康图表组件
│   │   └── ...                 # 其他组件
│   ├── utils/                  # 工具函数
│   │   ├── util.js             # 通用工具
│   │   ├── api.js              # API封装
│   │   └── constants.js        # 常量定义
│   ├── images/                 # 图片资源
│   ├── styles/                 # 样式文件
│   ├── app.js                  # 小程序入口
│   ├── app.json                # 小程序配置
│   └── app.wxss                # 全局样式
├── cloudfunctions/             # 云函数
│   ├── saveUser/               # 保存用户信息
│   ├── getPets/                # 获取宠物列表
│   └── ...                     # 其他云函数
├── docs/                       # 项目文档
└── README.md                   # 项目说明
```

## 3. 开发规范

### 3.1 命名规范
- **文件命名**: 使用kebab-case，如`pet-card.js`
- **变量命名**: 使用camelCase，如`petInfo`
- **常量命名**: 使用UPPER_SNAKE_CASE，如`API_BASE_URL`
- **组件命名**: 使用PascalCase，如`PetCard`

### 3.2 代码规范
- 使用2个空格缩进
- 行末不留空格
- 文件末尾保留一个空行
- 使用单引号包裹字符串
- 对象和数组最后一个元素后不加逗号

### 3.3 注释规范
```javascript
/**
 * 函数功能描述
 * @param {string} param1 - 参数1描述
 * @param {number} param2 - 参数2描述
 * @returns {object} 返回值描述
 */
function exampleFunction(param1, param2) {
  // 单行注释
  return {};
}
```

## 4. 页面开发

### 4.1 页面结构
每个页面包含4个文件：
- `.wxml` - 页面结构
- `.wxss` - 页面样式
- `.js` - 页面逻辑
- `.json` - 页面配置

### 4.2 页面生命周期
```javascript
Page({
  data: {
    // 页面数据
  },

  onLoad(options) {
    // 页面加载
  },

  onShow() {
    // 页面显示
  },

  onReady() {
    // 页面初次渲染完成
  },

  onHide() {
    // 页面隐藏
  },

  onUnload() {
    // 页面卸载
  },

  onPullDownRefresh() {
    // 下拉刷新
  },

  onReachBottom() {
    // 上拉触底
  }
});
```

### 4.3 数据绑定
```xml
<!-- 文本绑定 -->
<text>{{message}}</text>

<!-- 属性绑定 -->
<image src="{{imageSrc}}" />

<!-- 条件渲染 -->
<view wx:if="{{condition}}">显示内容</view>

<!-- 列表渲染 -->
<view wx:for="{{list}}" wx:key="id">
  {{item.name}}
</view>
```

## 5. 组件开发

### 5.1 组件结构
```javascript
Component({
  properties: {
    // 组件属性
    title: {
      type: String,
      value: ''
    }
  },

  data: {
    // 组件内部数据
  },

  methods: {
    // 组件方法
    handleTap() {
      this.triggerEvent('tap', {
        // 事件数据
      });
    }
  }
});
```

### 5.2 组件通信
```javascript
// 父组件向子组件传递数据
<custom-component title="{{title}}" />

// 子组件向父组件传递事件
this.triggerEvent('customEvent', eventData);

// 父组件监听子组件事件
<custom-component bind:customEvent="handleCustomEvent" />
```

## 6. 云函数开发

### 6.1 云函数结构
```javascript
const cloud = require('wx-server-sdk');

cloud.init({
  env: cloud.DYNAMIC_CURRENT_ENV
});

const db = cloud.database();

exports.main = async (event, context) => {
  const wxContext = cloud.getWXContext();
  
  try {
    // 业务逻辑
    const result = await db.collection('pets').get();
    
    return {
      success: true,
      data: result.data
    };
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
};
```

### 6.2 数据库操作
```javascript
// 查询
const result = await db.collection('pets').where({
  userId: wxContext.OPENID
}).get();

// 添加
const addResult = await db.collection('pets').add({
  data: petData
});

// 更新
const updateResult = await db.collection('pets').doc(petId).update({
  data: updateData
});

// 删除
const deleteResult = await db.collection('pets').doc(petId).remove();
```

## 7. 调试技巧

### 7.1 控制台调试
```javascript
// 输出调试信息
console.log('调试信息:', data);
console.error('错误信息:', error);

// 断点调试
debugger;
```

### 7.2 网络调试
- 在微信开发者工具中查看网络请求
- 检查云函数调用日志
- 使用云开发控制台查看数据库操作

### 7.3 真机调试
- 使用微信开发者工具的真机调试功能
- 在手机上预览小程序
- 查看真机调试日志

## 8. 性能优化

### 8.1 代码优化
- 避免在循环中进行复杂计算
- 合理使用setData，避免频繁更新
- 及时清理定时器和监听器

### 8.2 资源优化
- 压缩图片资源
- 使用webp格式图片
- 合理使用图片懒加载

### 8.3 网络优化
- 减少网络请求次数
- 使用数据缓存
- 合理设置请求超时时间

## 9. 测试指南

### 9.1 功能测试
- 测试所有页面的基本功能
- 测试用户交互流程
- 测试异常情况处理

### 9.2 兼容性测试
- 测试不同机型的兼容性
- 测试不同微信版本的兼容性
- 测试网络异常情况

### 9.3 性能测试
- 测试页面加载速度
- 测试内存使用情况
- 测试电量消耗

## 10. 发布流程

### 10.1 代码检查
- 代码格式检查
- 功能完整性检查
- 性能优化检查

### 10.2 提交审核
- 填写版本信息
- 上传代码包
- 提交微信审核

### 10.3 发布上线
- 审核通过后发布
- 监控线上运行状态
- 收集用户反馈

## 11. 常见问题

### 11.1 开发问题
- **问题**: 云函数调用失败
- **解决**: 检查云函数权限配置和网络连接

- **问题**: 页面数据不更新
- **解决**: 检查setData调用和数据绑定

### 11.2 部署问题
- **问题**: 小程序审核不通过
- **解决**: 根据审核意见修改相关内容

- **问题**: 云开发环境配置错误
- **解决**: 重新配置云开发环境ID
